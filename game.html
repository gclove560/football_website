<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Road Home</title>
<style>
body {
  margin: 0; font-family: monospace; color: white;
  background: linear-gradient(#0b1a2b, #06111a);
  display: flex; justify-content: center; align-items: center; height: 100vh;
}
.screen { display: none; text-align: center; width: 900px; padding: 20px; border-radius: 12px; }
#mainScreen { display: block; background: linear-gradient(#0b1a2b, #06111a); border: 2px solid #0a4d2d; }
h1 { font-size: 3rem; margin-bottom: 20px; text-shadow: 2px 2px #4d2600; color: #0a4d2d; }
button { padding: 12px 24px; font-size: 1.2rem; margin-top: 20px; cursor: pointer; border-radius: 8px; border: none; background-color: #0a4d2d; color: #d9b382; font-weight: bold; }
button:hover { background-color: #0f653f; }

#gameScreen { display: none; flex-direction: row; align-items: flex-start; }
#gameContainer { display: flex; flex-direction: column; align-items: center; }
#hud { margin-bottom: 10px; font-size: 1rem; background-color: rgba(0,0,50,0.5); padding: 5px 10px; border-radius: 6px; width: 220px; text-align: left; }
#game { display: grid; grid-template-columns: repeat(20, 32px); grid-template-rows: repeat(15, 32px); gap: 2px; background: #06111a; padding: 6px; border-radius: 8px; }

.tile { width: 32px; height: 32px; display: flex; justify-content: center; align-items: center; font-size: 20px; border-radius: 4px; }
.grass { background: #0a4d2d; } 
.wall { background: #4d2600; }
.player { background: #d9b382; color: black; } 
.enemy { background: #b30000; } 
.boss { background: #6a0dad; }
.projectile { background: yellow; border-radius: 50%; }

#sidebar { margin-left: 10px; width: 200px; }
#winScreen, #deathScreen { display: none; font-size: 2rem; padding: 20px; background: #0a4d2d; color: #d9b382; border-radius: 12px; text-align: center; }
#deathScreen button { display: block; margin-top: 10px; width: 150px; }

ul { padding-left: 16px; }
</style>
</head>
<body>

<div id="mainScreen" class="screen">
  <h1>The Road Home</h1>
  <p>Embark on a maze-like journey through the night. Can you survive and defeat all enemies?</p>
  <button onclick="startGame()">Start Game</button>
</div>

<div id="gameScreen" class="screen">
  <div id="gameContainer">
    <div id="hud"></div>
    <div id="game"></div>
  </div>
  <div id="sidebar">
    <h3>Goal</h3>
    <p>Defeat all enemies and find the exit to progress.</p>
    <h3>Controls</h3>
    <ul>
      <li>Arrow keys: Move</li>
      <li>Space: Attack adjacent enemies</li>
    </ul>
  </div>
</div>

<div id="winScreen">
  ðŸŽ‰ CONGRATULATIONS! ðŸŽ‰<br><br>
  You survived all 15 levels and completed "The Road Home"!
</div>

<div id="deathScreen">
  ðŸ’€ You have died! ðŸ’€<br>
  What would you like to do?
  <button onclick="revive()">Revive (continue)</button>
  <button onclick="restartLevel()">Restart Level</button>
  <button onclick="restartGame()">Restart Game</button>
</div>

<script>
const MAX_LEVEL = 15;
let level = 1;
let health = 5;
let player = {x:1,y:1};
let enemies = [];
let projectiles = [];
let enemyInterval, projectileInterval, bossInterval;
let baseProjectileSpeed = 500;
let projectileSpeed = baseProjectileSpeed;

// Maze-like maps with obstacles
const maps = [
  [
    "WWWWWWWWWWWWWWWWWWWW",
    "WGWWGGGGGGGGGGGGGGGW",
    "WGWWGWWGGWWGWWGGGGGW",
    "WGGGGWWGGGGGGGGGGGGW",
    "WGGWGGWWGGWGGGGGGGGW",
    "WGGWGGGGGGWGGWGGGGGW",
    "WGWWGGGGGGGGWGGGGGGW",
    "WGGGGWGGWGGGGWGGGGGW",
    "WGGGGGGWGGGGGGGGGGGW",
    "WGWWGGGGWGGGGWGGGGGW",
    "WGGGGGGGGGGWGGGGGGGW",
    "WGGWGGGGGGGGGGGGGGGW",
    "WGGGGGGGGWGGGGGGGGGW",
    "WGGGGGGGGGGGGGGGGGEW",
    "WWWWWWWWWWWWWWWWWWWW"
  ]
];
while(maps.length<MAX_LEVEL) maps.push(maps[0]);

const mainScreen=document.getElementById("mainScreen");
const gameScreen=document.getElementById("gameScreen");
const hud=document.getElementById("hud");
const game=document.getElementById("game");
const winScreen=document.getElementById("winScreen");
const deathScreen=document.getElementById("deathScreen");

// Start Game
function startGame(){
  mainScreen.style.display="none";
  gameScreen.style.display="flex";
  initLevel();
}

// Generate map
function generateMap(level){
  if(level%5===0){
    // Open map for boss
    const map = Array(15).fill(null).map((_,y)=>
      Array(20).fill('G').map((_,x)=>(y===0||y===14||x===0||x===19)?'W':'G')
    );
    map[13][18] = 'E';
    return map.map(r=>r.join(''));
  } else return maps[level-1];
}

let currentMap=[];

// Initialize Level
function initLevel(){
  player={x:1,y:1};
  health=5;
  currentMap=generateMap(level);
  enemies=generateEnemies();
  projectiles=[];
  draw();
  clearIntervals();
  enemyInterval=setInterval(moveEnemies,2000);
  projectileInterval=setInterval(moveProjectiles,projectileSpeed);
  if(level%5===0) bossInterval=setInterval(bossShoot,1500);
}

// Clear intervals
function clearIntervals(){
  clearInterval(enemyInterval);
  clearInterval(projectileInterval);
  clearInterval(bossInterval);
}

// Generate enemies
function generateEnemies(){
  const arr=[];
  const isBoss=level%5===0;
  if(isBoss){
    arr.push({x:Math.floor(Math.random()*18)+1, y:Math.floor(Math.random()*13)+1, hp:6, boss:true});
  } else {
    const count = level;
    for(let i=0;i<count;i++){
      arr.push({x:Math.floor(Math.random()*18)+1, y:Math.floor(Math.random()*13)+1, hp:2, boss:false});
    }
  }
  return arr;
}

// Draw game
function draw(){
  game.innerHTML="";
  hud.innerHTML=`â¤ï¸ ${"â¤ï¸".repeat(health)} | Level: ${level}/${MAX_LEVEL}`;
  const map=currentMap;
  for(let y=0;y<15;y++){
    for(let x=0;x<20;x++){
      const tile=document.createElement("div");
      tile.classList.add("tile");
      if(player.x===x&&player.y===y){ tile.classList.add("player"); tile.textContent="ðŸ§‘"; }
      else{
        const enemy=enemies.find(e=>e.x===x&&e.y===y);
        const proj=projectiles.find(p=>p.x===x&&p.y===y);
        if(proj){ tile.classList.add("projectile"); tile.textContent="â€¢"; }
        else if(enemy){ tile.classList.add(enemy.boss?"boss":"enemy"); tile.textContent=enemy.boss?"ðŸ‘¹":"ðŸ‘¾"; }
        else if(map[y][x]==="E"){ tile.textContent=(level===MAX_LEVEL?"ðŸ ":"âœ¨"); tile.classList.add("grass"); }
        else tile.classList.add(map[y][x]==="W"?"wall":"grass");
      }
      game.appendChild(tile);
    }
  }
}

// Player attack
function attack(){
  const dirs=[[0,-1],[0,1],[-1,0],[1,0]];
  for(const d of dirs){
    const ex=player.x+d[0], ey=player.y+d[1];
    const enemy=enemies.find(e=>e.x===ex&&e.y===ey);
    if(enemy){
      enemy.hp--;
      if(enemy.hp<=0) enemies=enemies.filter(e=>e!==enemy);
    }
  }
  checkLevelComplete();
  draw();
}

// Move player
function movePlayer(dx,dy){
  const nx=player.x+dx, ny=player.y+dy;
  if(currentMap[ny][nx]==="W") return;
  const enemy=enemies.find(e=>e.x===nx&&e.y===ny);
  if(enemy){ health--; if(health<=0){ showDeathScreen(); return; } }
  else player={x:nx,y:ny};
  checkLevelComplete();
  draw();
}

// Check level complete
function checkLevelComplete(){
  if(enemies.length===0 && currentMap[player.y][player.x]==="E"){
    if(level===MAX_LEVEL) winGame();
    else { 
      if(level%5===0) projectileSpeed = Math.max(100, projectileSpeed-50); // slightly faster after boss
      level++; initLevel(); 
    }
  }
}

// Enemy movement
function moveEnemies(){
  const map=currentMap;
  for(const e of enemies){
    if(!e.boss){
      const dirs=[[0,-1],[0,1],[-1,0],[1,0]];
      const d=dirs[Math.floor(Math.random()*dirs.length)];
      const nx=e.x+d[0], ny=e.y+d[1];
      if(map[ny][nx]!=="W" && !(nx===player.x && ny===player.y)) e.x=nx, e.y=ny;
      shootAtPlayer(e);
    }
  }
  draw();
}

// Shoot projectile toward player
function shootAtPlayer(enemy){
  const dx=Math.sign(player.x-enemy.x);
  const dy=Math.sign(player.y-enemy.y);
  if(dx!==0||dy!==0) projectiles.push({x:enemy.x, y:enemy.y, dx, dy});
}

// Boss shooting patterns (random directions)
function bossShoot(){
  const boss = enemies.find(e=>e.boss);
  if(!boss) return;
  let bulletsCount = level===5?3:level===10?4:5;
  for(let i=0;i<bulletsCount;i++){
    let dx = Math.floor(Math.random()*3)-1;
    let dy = Math.floor(Math.random()*3)-1;
    if(dx!==0||dy!==0) projectiles.push({x:boss.x,y:boss.y,dx,dy});
  }
}

// Move projectiles
function moveProjectiles(){
  const map=currentMap;
  const newProj=[];
  for(const p of projectiles){
    const nx=p.x+p.dx, ny=p.y+p.dy;
    if(nx<0||nx>=20||ny<0||ny>=15||map[ny][nx]==="W") continue;
    if(nx===player.x && ny===player.y){ health--; if(health<=0){ showDeathScreen(); return; } continue; }
    newProj.push({x:nx,y:ny,dx:p.dx,dy:p.dy});
  }
  projectiles=newProj;
  draw();
}

// Death / Revive / Restart
function showDeathScreen(){ gameScreen.style.display="none"; deathScreen.style.display="block"; }
function revive(){ health=5; deathScreen.style.display="none"; gameScreen.style.display="flex"; draw(); }
function restartLevel(){ initLevel(); deathScreen.style.display="none"; gameScreen.style.display="flex"; draw(); }
function restartGame(){ level=1; projectileSpeed = baseProjectileSpeed; initLevel(); deathScreen.style.display="none"; gameScreen.style.display="flex"; draw(); }
function winGame(){ gameScreen.style.display="none"; winScreen.style.display="block"; }

// Controls
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowUp") movePlayer(0,-1);
  if(e.key==="ArrowDown") movePlayer(0,1);
  if(e.key==="ArrowLeft") movePlayer(-1,0);
  if(e.key==="ArrowRight") movePlayer(1,0);
  if(e.key===" ") attack();
});

</script>
</body>
</html>
